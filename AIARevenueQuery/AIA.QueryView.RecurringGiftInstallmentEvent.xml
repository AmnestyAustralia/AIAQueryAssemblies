<QueryViewSpec
  xmlns="bb_appfx_queryview"
  xmlns:c="bb_appfx_commontypes" 
  ID="19ebc46d-0ad4-4a1d-a5b1-ce9e6104468a"
  Name="Recurring Gift Installment Events (AIA)"
  Description="Query to retrieve events associated with recurring gift installments"
  Author="Danny Smith (AIA)"
  IsRoot="false"
  PrimaryKeyField="ID"
  RecordType="Installment"
  c:SecurityUIFolder="Revenue\Recurring Gifts"
  >

  <ViewImplementation ViewName="USR_AIA_V_QUERY_RECURRINGGIFTINSTALLMENTEVENT">
    <ViewSQL>
      <![CDATA[
select
  RGIE.ID,
  RGIE.RECURRINGGIFTINSTALLMENTID,
  RGIE.BATCHID,
  RGIE.PAYMENTID,
  RGIE.[DATE],
  RGIE.[EVENT],
  RGIE.PROCESSNAME,
  RGIE.RESULTCODE,
  RGIE.REJECTIONMESSAGE,
  ADDEDBY.APPLICATIONNAME as [ADDEDBY_APPLICATION],
  ADDEDBY.USERNAME as [ADDEDBY_USERNAME],
  CHANGEDBY.APPLICATIONNAME as [CHANGEDBY_APPLICATION],
  CHANGEDBY.USERNAME as [CHANGEDBY_USERNAME],
  RGIE.DATEADDED,
  RGIE.DATECHANGED,
  RGIE.TSLONG
from
  dbo.RECURRINGGIFTINSTALLMENTEVENT AS RGIE with (nolock)
  left join dbo.CHANGEAGENT as ADDEDBY with (nolock) on ADDEDBY.ID = RGIE.ADDEDBYID
  left join dbo.CHANGEAGENT as CHANGEDBY with (nolock) on CHANGEDBY.ID = RGIE.CHANGEDBYID
      ]]>
    </ViewSQL>
  </ViewImplementation>

  <Output>
    <OutputFields>
      <OutputField Caption="System record ID" Category="System Fields" Name="ID" CaptionResourceKey="$$system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Name="RECURRINGGIFTINSTALLMENTID" IsHidden="true" />
      <OutputField Name="BATCHID" Caption="Batch system record ID" DataType="Guid" Category="System Fields" CaptionResourceKey="$$batch_system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Name="PAYMENTID" Caption="Revenue system record ID" DataType="Guid" Category="System Fields" CaptionResourceKey="$$revenue_system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Name="DATE" Caption="Date" CaptionResourceKey="$$date" />
      <OutputField Name="EVENT" Caption="Event" CaptionResourceKey="$$event">
        <LookupInfo>
          <TranslationList>
            <c:Options>
              <c:TranslationListOption Value="Processing" />
              <c:TranslationListOption Value="Credit card authorization" />
              <c:TranslationListOption Value="Credit card rejection" />
              <c:TranslationListOption Value="Direct debit rejection" />
              <c:TranslationListOption Value="Installment amount changed" />
            </c:Options>
          </TranslationList>
        </LookupInfo>
      </OutputField>
      <OutputField Name="PROCESSNAME" Caption="Process name" />
      <OutputField Name="RESULTCODE" Caption="Result code" />
      <OutputField Name="REJECTIONMESSAGE" Caption="Rejection message" />
      <OutputField Caption="Added by application" Category="System Fields" Name="ADDEDBY_APPLICATION" CaptionResourceKey="$$added_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Added by user name" Category="System Fields" Name="ADDEDBY_USERNAME" CaptionResourceKey="$$added_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by application" Category="System Fields" Name="CHANGEDBY_APPLICATION" CaptionResourceKey="$$changed_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by user name" Category="System Fields" Name="CHANGEDBY_USERNAME" CaptionResourceKey="$$changed_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Date added" Category="System Fields" Name="DATEADDED" CaptionResourceKey="$$date_added" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Date changed" Category="System Fields" Name="DATECHANGED" CaptionResourceKey="$$date_changed" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Timestamp value" Category="System Fields" IsHidden="true" Name="TSLONG" />
    </OutputFields>
  </Output>

  <RelationshipOperations>
    <AddToParentView PathAlias="Recurring Gift Installment Events (AIA)" ParentView="USR_AIA_V_QUERY_RECURRINGGIFTINSTALLMENT" Field="RECURRINGGIFTINSTALLMENTID" ParentViewRelatedField="ID" />
    <!--<AddRelatedView RelatedView="V_QUERY_REVENUE" PathAlias="Revenue" Field="PAYMENTID" RelatedField="ID" DisplayAliasResourceKey="$$revenue" />-->
    <AddRelatedView RelatedView="V_QUERY_REVENUESPLIT" PathAlias="Payments" Field="PAYMENTID" RelatedField="ID" DisplayAliasResourceKey="$$payments" />
    <AddRelatedView RelatedView="V_QUERY_BATCH" PathAlias="Batch" Field="BATCHID" RelatedField="ID" DisplayAliasResourceKey="$$batch" />
  </RelationshipOperations>
</QueryViewSpec>

