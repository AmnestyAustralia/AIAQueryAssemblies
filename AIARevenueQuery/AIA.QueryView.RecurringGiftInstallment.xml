<QueryViewSpec
  xmlns="bb_appfx_queryview"
  xmlns:c="bb_appfx_commontypes" 
  ID="db66bd2e-0893-4bdd-a3a4-053dfc457954"
  Name="Recurring Gift Installments (AIA)"
  Description="Query to retrieve installment information associated with recurring gifts"
  Author="Danny Smith (AIA)"
  IsRoot="false"
  PrimaryKeyField="ID"
  RecordType="Revenue"
  c:SecurityUIFolder="Revenue\Recurring Gifts"
  >

  <ViewImplementation ViewName="USR_AIA_V_QUERY_RECURRINGGIFTINSTALLMENT">
    <ViewSQL>
      <![CDATA[
select
  RGI.ID,
  RGI.REVENUEID,
  RGI.AMOUNT,
  RGI.DATE,
  RGI.STATUS,
  RGI.PASTDUEDATE,
  RGI.BASECURRENCYID,
  RGI.ORGANIZATIONAMOUNT,
  RGI.ORGANIZATIONEXCHANGERATEID,
  RGI.TRANSACTIONAMOUNT,
  RGI.TRANSACTIONCURRENCYID,
  RGI.BASEEXCHANGERATEID,
  ADDEDBY.APPLICATIONNAME as [ADDEDBY_APPLICATION],
  ADDEDBY.USERNAME as [ADDEDBY_USERNAME],
  CHANGEDBY.APPLICATIONNAME as [CHANGEDBY_APPLICATION],
  CHANGEDBY.USERNAME as [CHANGEDBY_USERNAME],
  RGI.DATEADDED,
  RGI.DATECHANGED,
  RGI.TSLONG
from
  dbo.RECURRINGGIFTINSTALLMENT AS RGI with (nolock)
  left join dbo.CHANGEAGENT as ADDEDBY with (nolock) on ADDEDBY.ID = RGI.ADDEDBYID
  left join dbo.CHANGEAGENT as CHANGEDBY with (nolock) on CHANGEDBY.ID = RGI.CHANGEDBYID

      ]]>
    </ViewSQL>
  </ViewImplementation>

  <Output>
    <OutputFields>
      <OutputField Caption="System record ID" DataType="Guid" Category="System Fields" Name="ID" CaptionResourceKey="$$system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Name="REVENUEID" IsHidden="true" />
      <OutputField Name="AMOUNT" Caption="Amount" CaptionResourceKey="$$amount">
        <CurrencyField CurrencyFieldID="BASECURRENCYID" />
      </OutputField>
      <OutputField Name="DATE" Caption="Date" CaptionResourceKey="$$date" />
      <OutputField Name="STATUS" Caption="Status" CaptionResourceKey="$$status">
        <LookupInfo>
          <TranslationList>
            <c:Options>
              <c:TranslationListOption Value="Expected" />
              <c:TranslationListOption Value="Past due" />
              <c:TranslationListOption Value="Paid" />
              <c:TranslationListOption Value="Skipped" />
              <c:TranslationListOption Value="Write-off" />
            </c:Options>
          </TranslationList>
        </LookupInfo>
      </OutputField>
      <OutputField Name="PASTDUEDATE" Caption="Past Due Date" CaptionResourceKey="$$date" />
      <OutputField Name="BASECURRENCYID" DataType="Guid" Caption="Base currency ID" IsHidden="true" CaptionResourceKey="$$base_currency_id">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Name="BASEEXCHANGERATEID" DataType="Guid" Caption="Base exchange rate" IsHidden="true" CaptionResourceKey="$$base_exchange_rate">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Name="ORGANIZATIONAMOUNT" DataType="Money" Caption="Amount (organization currency)" CaptionResourceKey="$$amount_(organization_currency)">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Name="ORGANIZATIONEXCHANGERATEID" DataType="Guid" Caption="Organization exchange rate" IsHidden="true" CaptionResourceKey="$$organization_exchange_rate">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Name="TRANSACTIONAMOUNT" DataType="Money" Caption="Amount (transaction currency)" CaptionResourceKey="$$amount_(transaction_currency)">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
        <CurrencyField CurrencyFieldID="TRANSACTIONCURRENCYID" />
      </OutputField>
      <OutputField Name="TRANSACTIONCURRENCYID" DataType="Guid" Caption="Transaction currency ID" IsHidden="true" CaptionResourceKey="$$transaction_currency_id">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Caption="Added by application" Category="System Fields" Name="ADDEDBY_APPLICATION" CaptionResourceKey="$$added_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Added by user name" Category="System Fields" Name="ADDEDBY_USERNAME" CaptionResourceKey="$$added_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by application" Category="System Fields" Name="CHANGEDBY_APPLICATION" CaptionResourceKey="$$changed_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by user name" Category="System Fields" Name="CHANGEDBY_USERNAME" CaptionResourceKey="$$changed_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Date added" Category="System Fields" Name="DATEADDED" CaptionResourceKey="$$date_added" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Date changed" Category="System Fields" Name="DATECHANGED" CaptionResourceKey="$$date_changed" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Timestamp value" Category="System Fields" IsHidden="true" Name="TSLONG" />
    </OutputFields>
  </Output>
  <RelationshipOperations>
    <AddToParentView PathAlias="Recurring Gift Installments (AIA)" ParentView="V_QUERY_REVENUE" Field="REVENUEID" ParentViewRelatedField="ID" />
    <AddRelatedView Field="BASEEXCHANGERATEID" RelatedView="V_QUERY_CURRENCYEXCHANGERATE" RelatedField="ID" PathAlias="Base Exchange Rate" DisplayAliasResourceKey="$$base_exchange_rate0" />
    <AddRelatedView Field="ORGANIZATIONEXCHANGERATEID" RelatedView="V_QUERY_CURRENCYEXCHANGERATE" RelatedField="ID" PathAlias="Organization Exchange Rate" DisplayAliasResourceKey="$$organization_exchange_rate0" />
    <AddRelatedView Field="BASECURRENCYID" RelatedView="V_QUERY_CURRENCY" RelatedField="ID" PathAlias="Base Currency" DisplayAliasResourceKey="$$base_currency" />
    <AddRelatedView Field="TRANSACTIONCURRENCYID" RelatedView="V_QUERY_CURRENCY" RelatedField="ID" PathAlias="Transaction Currency" DisplayAliasResourceKey="$$transaction_currency" />
  </RelationshipOperations>
</QueryViewSpec>

