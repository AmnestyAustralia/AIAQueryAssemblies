<QueryViewSpec
  xmlns="bb_appfx_queryview"
  xmlns:c="bb_appfx_commontypes" 
  ID="58894797-8b1b-47b0-8300-bdb3c1856228"
  Name="Recurring Gift Installment Payments (AIA)"
  Description="Query to retrieve payments associated with recurring gift installments"
  Author="Danny Smith (AIA)"
  IsRoot="false"
  PrimaryKeyField="ID"
  RecordType="Installment"
  c:SecurityUIFolder="Revenue\Recurring Gifts"
  >

  <ViewImplementation ViewName="USR_AIA_V_QUERY_RECURRINGGIFTINSTALLMENTPAYMENT">
    <ViewSQL>
      <![CDATA[
select
  RGIP.ID,
  RGIP.RECURRINGGIFTINSTALLMENTID,
  RGIP.PAYMENTID,
  RGIP.AMOUNT,
  RGIP.APPLICATIONCURRENCYID,
  RGIP.APPLICATIONEXCHANGERATEID,
  ADDEDBY.APPLICATIONNAME as [ADDEDBY_APPLICATION],
  ADDEDBY.USERNAME as [ADDEDBY_USERNAME],
  CHANGEDBY.APPLICATIONNAME as [CHANGEDBY_APPLICATION],
  CHANGEDBY.USERNAME as [CHANGEDBY_USERNAME],
  RGIP.DATEADDED,
  RGIP.DATECHANGED,
  RGIP.TSLONG
from
  dbo.RECURRINGGIFTINSTALLMENTPAYMENT AS RGIP with (nolock)
  left join dbo.CHANGEAGENT as ADDEDBY with (nolock) on ADDEDBY.ID = RGIP.ADDEDBYID
  left join dbo.CHANGEAGENT as CHANGEDBY with (nolock) on CHANGEDBY.ID = RGIP.CHANGEDBYID
      ]]>
    </ViewSQL>
  </ViewImplementation>

  <Output>
    <OutputFields>
      <OutputField Caption="System record ID" Category="System Fields" Name="ID" CaptionResourceKey="$$system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Name="RECURRINGGIFTINSTALLMENTID" IsHidden="true" />
      <OutputField Name="PAYMENTID" Caption="Revenue system record ID" DataType="Guid" Category="System Fields" CaptionResourceKey="$$revenue_system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Name="AMOUNT" Caption="Amount" CaptionResourceKey="$$amount">
        <CurrencyField CurrencyFieldID="APPLICATIONCURRENCYID" />
      </OutputField>
      <OutputField Name="APPLICATIONCURRENCYID" DataType="Guid" Caption="Application currency ID" IsHidden="true" CaptionResourceKey="$$application_currency_id">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Name="APPLICATIONEXCHANGERATEID" DataType="Guid" Caption="Application exchange rate" IsHidden="true" CaptionResourceKey="$$application_exchange_rate">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Caption="Added by application" Category="System Fields" Name="ADDEDBY_APPLICATION" CaptionResourceKey="$$added_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Added by user name" Category="System Fields" Name="ADDEDBY_USERNAME" CaptionResourceKey="$$added_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by application" Category="System Fields" Name="CHANGEDBY_APPLICATION" CaptionResourceKey="$$changed_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by user name" Category="System Fields" Name="CHANGEDBY_USERNAME" CaptionResourceKey="$$changed_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Date added" Category="System Fields" Name="DATEADDED" CaptionResourceKey="$$date_added" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Date changed" Category="System Fields" Name="DATECHANGED" CaptionResourceKey="$$date_changed" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Timestamp value" Category="System Fields" IsHidden="true" Name="TSLONG" />
    </OutputFields>
  </Output>

  <RelationshipOperations>
    <AddToParentView PathAlias="Recurring Gift Installment Payments (AIA)" ParentView="USR_AIA_V_QUERY_RECURRINGGIFTINSTALLMENT" Field="RECURRINGGIFTINSTALLMENTID" ParentViewRelatedField="ID" />
    <!--<AddRelatedView RelatedView="V_QUERY_REVENUE" PathAlias="Revenue" Field="PAYMENTID" RelatedField="ID" DisplayAliasResourceKey="$$revenue" />-->
    <AddRelatedView RelatedView="V_QUERY_REVENUESPLIT" PathAlias="Payments" Field="PAYMENTID" RelatedField="ID" DisplayAliasResourceKey="$$payments" />
  </RelationshipOperations>
</QueryViewSpec>

