<QueryViewSpec
  xmlns="bb_appfx_queryview"
  xmlns:c="bb_appfx_commontypes" 
  ID="83ddcc4a-df1f-43ee-af54-d700d4e5f1cb"
  Name="Recurring Gift Installment Writeoffs (AIA)"
  Description="Query to retrieve events associated with recurring gift writeoffs"
  Author="Danny Smith (AIA)"
  IsRoot="false"
  PrimaryKeyField="ID"
  RecordType="Installment"
  c:SecurityUIFolder="Revenue\Recurring Gifts"
  >

  <ViewImplementation ViewName="USR_AIA_V_QUERY_RECURRINGGIFTINSTALLMENTWRITEOFF">
    <ViewSQL>
      <![CDATA[
select
  RGIW.ID,
  RGIW.RECURRINGGIFTINSTALLMENTID,
  RGIW.WRITEOFFID,
  RGIW.AMOUNT,
  RGIW.BASECURRENCYID,
  RGIW.BASEEXCHANGERATEID,
  ADDEDBY.APPLICATIONNAME as [ADDEDBY_APPLICATION],
  ADDEDBY.USERNAME as [ADDEDBY_USERNAME],
  CHANGEDBY.APPLICATIONNAME as [CHANGEDBY_APPLICATION],
  CHANGEDBY.USERNAME as [CHANGEDBY_USERNAME],
  RGIW.DATEADDED,
  RGIW.DATECHANGED,
  RGIW.TSLONG
from
  dbo.RECURRINGGIFTINSTALLMENTWRITEOFF AS RGIW with (nolock)
  left join dbo.CHANGEAGENT as ADDEDBY with (nolock) on ADDEDBY.ID = RGIW.ADDEDBYID
  left join dbo.CHANGEAGENT as CHANGEDBY with (nolock) on CHANGEDBY.ID = RGIW.CHANGEDBYID
      ]]>
    </ViewSQL>
  </ViewImplementation>

  <Output>
    <OutputFields>
      <OutputField Caption="System record ID" Category="System Fields" Name="ID" CaptionResourceKey="$$system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Name="RECURRINGGIFTINSTALLMENTID" IsHidden="true" />
      <OutputField Name="WRITEOFFID" Caption="Write-off system record ID" DataType="Guid" Category="System Fields" CaptionResourceKey="$$writeoff_system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Name="AMOUNT" Caption="Amount" CaptionResourceKey="$$amount">
        <CurrencyField CurrencyFieldID="BASECURRENCYID" />
      </OutputField>
      <OutputField Name="BASECURRENCYID" DataType="Guid" Caption="Base currency ID" IsHidden="true" CaptionResourceKey="$$base_currency_id">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Name="BASEEXCHANGERATEID" DataType="Guid" Caption="Base exchange rate" IsHidden="true" CaptionResourceKey="$$base_exchange_rate">
        <OutputFieldHiddenCondition>
          <c:DoesNotExistCondition Key="Multicurrency" />
        </OutputFieldHiddenCondition>
      </OutputField>
      <OutputField Caption="Added by application" Category="System Fields" Name="ADDEDBY_APPLICATION" CaptionResourceKey="$$added_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Added by user name" Category="System Fields" Name="ADDEDBY_USERNAME" CaptionResourceKey="$$added_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by application" Category="System Fields" Name="CHANGEDBY_APPLICATION" CaptionResourceKey="$$changed_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by user name" Category="System Fields" Name="CHANGEDBY_USERNAME" CaptionResourceKey="$$changed_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Date added" Category="System Fields" Name="DATEADDED" CaptionResourceKey="$$date_added" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Date changed" Category="System Fields" Name="DATECHANGED" CaptionResourceKey="$$date_changed" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Timestamp value" Category="System Fields" IsHidden="true" Name="TSLONG" />
    </OutputFields>
  </Output>

  <RelationshipOperations>
    <AddToParentView PathAlias="Recurring Gift Installment Writeoffs (AIA)" ParentView="USR_AIA_V_QUERY_RECURRINGGIFTINSTALLMENT" Field="RECURRINGGIFTINSTALLMENTID" ParentViewRelatedField="ID" />
    <!--<AddRelatedView RelatedView="V_QUERY_INSTALLMENTWRITEOFF" PathAlias="Write-offs" Field="WRITEOFFID" RelatedField="ID" DisplayAliasResourceKey="$$write-offs" />-->
  </RelationshipOperations>
</QueryViewSpec>

