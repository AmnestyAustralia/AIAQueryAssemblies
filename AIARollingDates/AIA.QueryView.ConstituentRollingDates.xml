<QueryViewSpec
	xmlns="bb_appfx_queryview"
	xmlns:common="bb_appfx_commontypes" 
	ID="8BA0162E-3C7B-4ED8-AB8C-66A5432C3CFE"
	Name="Constituent Rolling Dates (AIA)"
	Description="A custom view for rolling dates linked to constituents"
	Author="Danny Smith (AIA)"
	IsRoot="false"
	PrimaryKeyField="ID"
	RecordType="Constituent"
	common:SecurityUIFolder="Constituent"
>

  <!-- Adapted from a script by David Bourne (TWS) -->

  <!-- define the view used to return data for the query -->
  <ViewImplementation ViewName="USR_AIA_V_QUERY_CONSTITUENT_ROLLING_DATES">
    <ViewSQL>
      <![CDATA[
      
SELECT 
  c.ID as ID,
  
  -- Recent rolling dates
  cast(GETDATE() as date) as Today,
  cast(DATEADD(day, -1, GETDATE()) as date) as Yesterday,
  cast(DATEADD(day, +1, GETDATE()) as date) as Tomorrow,
  
  -- Previous periods
  cast(DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE())-1, 0) as date) as FirstDayofPreviousMonth,
  cast(DATEADD(MONTH, DATEDIFF(MONTH, -1, GETDATE())-1, -1) as date) as LastDayofPreviousMonth,
  cast(DATEADD(qq, DATEDIFF(qq, 0, GETDATE()) - 1, 0) as date) as FirstDayofPreviousQuarter,
  cast(DATEADD(dd, -1, DATEADD(qq, DATEDIFF(qq, 0, GETDATE()), 0)) as date) as LastDayofPreviousQuarter,
  cast(DATEADD(yy, DATEDIFF(yy, 0, GETDATE()) - 1, 0) as date) as FirstDayofPreviousCalendarYear,
  cast(DATEADD(dd, -1, DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0)) as date) as LastDayofPreviousCalendarYear,
  cast(DATEADD(MONTH, 6, DATEADD(YEAR, DATEDIFF(YEAR, 0, DATEADD(MONTH, -18, GETDATE())), 0)) as date) as FirstDayofPreviousFiscalYear, 
  cast(DATEADD(Day,-1,DATEADD(MONTH, 6,DATEADD(YEAR, DATEDIFF(YEAR,0,DATEADD(MONTH,-6, GETDATE())),0) )) as date) as LastDayofPreviousFiscalYear, 

  -- Current period
  cast(DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0) as date) as FirstDayofCurrentMonth,
  cast(DATEADD(DAY,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) as LastDayofCurrentMonth,
  cast(DATEADD(qq, DATEDIFF(qq, 0, GETDATE()), 0) as date) as FirstDayofCurrentQuarter,
  cast(DATEADD (dd, -1, DATEADD(qq, DATEDIFF(qq, 0, GETDATE()) +1, 0)) as date) as LastDayofCurrentQuarter,
  cast(DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0) as date) as FirstDayofCurrentCalendarYear,
  cast(DATEADD (dd, -1, DATEADD(yy, DATEDIFF(yy, 0, GETDATE()) +1, 0)) as date) as LastDayofCurrentCalendarYear,
  cast(DATEADD(MONTH, 6, DATEADD(YEAR, DATEDIFF(YEAR, 0, DATEADD(MONTH, -6, GETDATE())), 0)) as date) as FirstDayofCurrentFiscalYear,  
  cast(DATEADD(Day,-1,DATEADD(MONTH, 6,DATEADD(YEAR, DATEDIFF(YEAR,0,DATEADD(MONTH,6, GETDATE())),0) )) as date) as LastDayofCurrentFiscalYear,      

  -- Next period 
  cast(DATEADD(m, DATEDIFF(m, -1, current_timestamp), 0) as date) as FirstDayofNextMonth,
  cast(DATEADD(DAY,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+2,0)) as date) as LastDayofNextMonth,
  cast(DATEADD(qq, DATEDIFF(qq, -1, current_timestamp), 0) as date) as FirstDayofNextQuarter,
  cast(DATEADD(dd,-1,DATEADD(qq, DATEDIFF(qq,0,GETDATE())+2,0)) as date) as LastDayofNextQuarter,

  -- Rolling dates backward
  cast(DATEADD(day, -2, GETDATE()) as date) as DaysAgo2,
  cast(DATEADD(day, -3, GETDATE()) as date) as DaysAgo3,
  cast(DATEADD(day, -4, GETDATE()) as date) as DaysAgo4,
  cast(DATEADD(day, -5, GETDATE()) as date) as DaysAgo5,
  cast(DATEADD(day, -6, GETDATE()) as date) as DaysAgo6,
  cast(DATEADD(day, -7, GETDATE()) as date) as DaysAgo7,
  cast(DATEADD(day, -8, GETDATE()) as date) as DaysAgo8,
  cast(DATEADD(day, -9, GETDATE()) as date) as DaysAgo9,
  cast(DATEADD(day, -10, GETDATE()) as date) as DaysAgo10,
  cast(DATEADD(day, -11, GETDATE()) as date) as DaysAgo11,
  cast(DATEADD(day, -12, GETDATE()) as date) as DaysAgo12,
  cast(DATEADD(day, -13, GETDATE()) as date) as DaysAgo13,
  cast(DATEADD(day, -14, GETDATE()) as date) as DaysAgo14,
  cast(DATEADD(day, -15, GETDATE()) as date) as DaysAgo15,
  cast(DATEADD(day, -16, GETDATE()) as date) as DaysAgo16,
  cast(DATEADD(day, -17, GETDATE()) as date) as DaysAgo17,
  cast(DATEADD(day, -18, GETDATE()) as date) as DaysAgo18,
  cast(DATEADD(day, -19, GETDATE()) as date) as DaysAgo19,
  cast(DATEADD(day, -20, GETDATE()) as date) as DaysAgo20,
  cast(DATEADD(day, -21, GETDATE()) as date) as DaysAgo21,
  cast(DATEADD(day, -22, GETDATE()) as date) as DaysAgo22,
  cast(DATEADD(day, -23, GETDATE()) as date) as DaysAgo23,
  cast(DATEADD(day, -24, GETDATE()) as date) as DaysAgo24,
  cast(DATEADD(day, -25, GETDATE()) as date) as DaysAgo25,
  cast(DATEADD(day, -26, GETDATE()) as date) as DaysAgo26,
  cast(DATEADD(day, -27, GETDATE()) as date) as DaysAgo27,
  cast(DATEADD(day, -28, GETDATE()) as date) as DaysAgo28,
  cast(DATEADD(day, -29, GETDATE()) as date) as DaysAgo29,
  cast(DATEADD(day, -30, GETDATE()) as date) as DaysAgo30,
  cast(DATEADD(day, -31, GETDATE()) as date) as DaysAgo31,
  cast(DATEADD(week, -1, (GETDATE())) as date) as WeeksAgo1,
  cast(DATEADD(week, -2, (GETDATE())) as date) as WeeksAgo2,
  cast(DATEADD(week, -3, (GETDATE())) as date) as WeeksAgo3,
  cast(DATEADD(week, -4, (GETDATE())) as date) as WeeksAgo4,
  cast(DATEADD(week, -5, (GETDATE())) as date) as WeeksAgo5,
  cast(DATEADD(week, -6, (GETDATE())) as date) as WeeksAgo6,
  cast(DATEADD(week, -7, (GETDATE())) as date) as WeeksAgo7,
  cast(DATEADD(week, -8, (GETDATE())) as date) as WeeksAgo8,
  cast(DATEADD(month, -1, (GETDATE())) as date) as MonthsAgo1,
  cast(DATEADD(month, -2, (GETDATE())) as date) as MonthsAgo2,
  cast(DATEADD(month, -3, (GETDATE())) as date) as MonthsAgo3,
  cast(DATEADD(month, -4, (GETDATE())) as date) as MonthsAgo4,
  cast(DATEADD(month, -5, (GETDATE())) as date) as MonthsAgo5,
  cast(DATEADD(month, -6, (GETDATE())) as date) as MonthsAgo6,
  cast(DATEADD(month, -7, (GETDATE())) as date) as MonthsAgo7,
  cast(DATEADD(month, -8, (GETDATE())) as date) as MonthsAgo8,
  cast(DATEADD(month, -9, (GETDATE())) as date) as MonthsAgo9,
  cast(DATEADD(month, -10, (GETDATE())) as date) as MonthsAgo10,
  cast(DATEADD(month, -11, (GETDATE())) as date) as MonthsAgo11,
  cast(DATEADD(month, -12, (GETDATE())) as date) as MonthsAgo12,
  cast(DATEADD(month, -18, (GETDATE())) as date) as MonthsAgo18,
  cast(DATEADD(year, -1, (GETDATE())) as date) as YearsAgo1,
  cast(DATEADD(year, -2, (GETDATE())) as date) as YearsAgo2,
  cast(DATEADD(year, -3, (GETDATE())) as date) as YearsAgo3,
  cast(DATEADD(year, -4, (GETDATE())) as date) as YearsAgo4,
  cast(DATEADD(year, -5, (GETDATE())) as date) as YearsAgo5,
  cast(DATEADD(year, -6, (GETDATE())) as date) as YearsAgo6,
  cast(DATEADD(year, -7, (GETDATE())) as date) as YearsAgo7,
  cast(DATEADD(year, -8, (GETDATE())) as date) as YearsAgo8,
  cast(DATEADD(year, -9, (GETDATE())) as date) as YearsAgo9,
  cast(DATEADD(year, -10, (GETDATE())) as date) as YearsAgo10,

  -- Rolling dates forward
  cast(DATEADD(day, +7, GETDATE()) as date) as DaysAhead7,
  cast(DATEADD(day, +14, GETDATE()) as date) as DaysAhead14,
  cast(DATEADD(day, +21, GETDATE()) as date) as DaysAhead21,
  cast(DATEADD(day, +28, GETDATE()) as date) as DaysAhead28,
  cast(DATEADD(month, +1, (GETDATE())) as date) as MonthsAhead1,
  cast(DATEADD(month, +2, (GETDATE())) as date) as MonthsAhead2,
  cast(DATEADD(month, +3, (GETDATE())) as date) as MonthsAhead3,
  cast(DATEADD(month, +4, (GETDATE())) as date) as MonthsAhead4,
  cast(DATEADD(month, +5, (GETDATE())) as date) as MonthsAhead5,
  cast(DATEADD(month, +6, (GETDATE())) as date) as MonthsAhead6

FROM 
  dbo.CONSTITUENT c

			]]>
    </ViewSQL>
  </ViewImplementation>

  <!-- describe each field in the view output -->
  <Output>
    <OutputFields>
      <OutputField Name="ID" Caption="System record ID" Category="System Fields"  />
      <OutputField Name="Today" Caption="Today" DataType="Date" />
      <OutputField Name="Yesterday" Caption="Yesterday" DataType="Date" />
      <OutputField Name="Tomorrow" Caption="Tomorrow" DataType="Date" />

      <OutputField Name="FirstDayofPreviousMonth" Caption="First Day of Previous Month" DataType="Date" />
      <OutputField Name="LastDayofPreviousMonth" Caption="Last Day of Previous Month" DataType="Date" />
      <OutputField Name="FirstDayofPreviousQuarter" Caption="First Day of Previous Quarter" DataType="Date" />
      <OutputField Name="LastDayofPreviousQuarter" Caption="Last Day of Previous Quarter" DataType="Date" />
      <OutputField Name="FirstDayofPreviousCalendarYear" Caption="First Day of Previous Calendar Year" DataType="Date" />
      <OutputField Name="LastDayofPreviousCalendarYear" Caption="Last Day of Previous Calendar Year" DataType="Date" />
      <OutputField Name="FirstDayofPreviousFiscalYear" Caption="First Day of Previous Fiscal Year" DataType="Date" />
      <OutputField Name="LastDayofPreviousFiscalYear" Caption="Last Day of Previous Fiscal Year" DataType="Date" />

      <OutputField Name="FirstDayofCurrentMonth" Caption="First Day of Current Month" DataType="Date" />
      <OutputField Name="LastDayofCurrentMonth" Caption="Last Day of Current Month" DataType="Date" />
      <OutputField Name="FirstDayofCurrentQuarter" Caption="First Day of Current Quarter" DataType="Date" />
      <OutputField Name="LastDayofCurrentQuarter" Caption="Last Day of Current Quarter" DataType="Date" />
      <OutputField Name="FirstDayofCurrentCalendarYear" Caption="First Day of Current Calendar Year" DataType="Date" />
      <OutputField Name="LastDayofCurrentCalendarYear" Caption="Last Day of Current Calendar Year" DataType="Date" />
      <OutputField Name="FirstDayofCurrentFiscalYear" Caption="First Day of Current Fiscal Year" DataType="Date" />
      <OutputField Name="LastDayofCurrentFiscalYear" Caption="Last Day of Current Fiscal Year" DataType="Date" />

      <OutputField Name="FirstDayofNextMonth" Caption="First Day of Next Month" DataType="Date" />
      <OutputField Name="LastDayofNextMonth" Caption="Last Day of Next Month" DataType="Date" />
      <OutputField Name="FirstDayofNextQuarter" Caption="First Day of Next Quarter" DataType="Date" />
      <OutputField Name="LastDayofNextQuarter" Caption="Last Day of Next Quarter" DataType="Date" />

      <OutputField Name="DaysAgo2" Caption="Days Ago 02" DataType="Date" />
      <OutputField Name="DaysAgo3" Caption="Days Ago 03" DataType="Date" />      
      <OutputField Name="DaysAgo4" Caption="Days Ago 04" DataType="Date" />
      <OutputField Name="DaysAgo5" Caption="Days Ago 05" DataType="Date" />      
      <OutputField Name="DaysAgo6" Caption="Days Ago 06" DataType="Date" />      
      <OutputField Name="DaysAgo7" Caption="Days Ago 07" DataType="Date" />
      <OutputField Name="DaysAgo8" Caption="Days Ago 08" DataType="Date" />
      <OutputField Name="DaysAgo9" Caption="Days Ago 09" DataType="Date" />      
      <OutputField Name="DaysAgo10" Caption="Days Ago 10" DataType="Date" />
      <OutputField Name="DaysAgo11" Caption="Days Ago 11" DataType="Date" />
      <OutputField Name="DaysAgo12" Caption="Days Ago 12" DataType="Date" />
      <OutputField Name="DaysAgo13" Caption="Days Ago 13" DataType="Date" />
      <OutputField Name="DaysAgo14" Caption="Days Ago 14" DataType="Date" />
      <OutputField Name="DaysAgo15" Caption="Days Ago 15" DataType="Date" />
      <OutputField Name="DaysAgo16" Caption="Days Ago 16" DataType="Date" />
      <OutputField Name="DaysAgo17" Caption="Days Ago 17" DataType="Date" />
      <OutputField Name="DaysAgo18" Caption="Days Ago 18" DataType="Date" />
      <OutputField Name="DaysAgo19" Caption="Days Ago 19" DataType="Date" />
      <OutputField Name="DaysAgo20" Caption="Days Ago 20" DataType="Date" />
      <OutputField Name="DaysAgo21" Caption="Days Ago 21" DataType="Date" />
      <OutputField Name="DaysAgo22" Caption="Days Ago 22" DataType="Date" />
      <OutputField Name="DaysAgo23" Caption="Days Ago 23" DataType="Date" />
      <OutputField Name="DaysAgo24" Caption="Days Ago 24" DataType="Date" />
      <OutputField Name="DaysAgo25" Caption="Days Ago 25" DataType="Date" />
      <OutputField Name="DaysAgo26" Caption="Days Ago 26" DataType="Date" />
      <OutputField Name="DaysAgo27" Caption="Days Ago 27" DataType="Date" />
      <OutputField Name="DaysAgo28" Caption="Days Ago 28" DataType="Date" />
      <OutputField Name="DaysAgo29" Caption="Days Ago 29" DataType="Date" />
      <OutputField Name="DaysAgo30" Caption="Days Ago 30" DataType="Date" />
      <OutputField Name="DaysAgo31" Caption="Days Ago 31" DataType="Date" />
      <OutputField Name="WeeksAgo1" Caption="Weeks Ago 1" DataType="Date" />
      <OutputField Name="WeeksAgo2" Caption="Weeks Ago 2" DataType="Date" />
      <OutputField Name="WeeksAgo3" Caption="Weeks Ago 3" DataType="Date" />
      <OutputField Name="WeeksAgo4" Caption="Weeks Ago 4" DataType="Date" />
      <OutputField Name="WeeksAgo5" Caption="Weeks Ago 5" DataType="Date" />
      <OutputField Name="WeeksAgo6" Caption="Weeks Ago 6" DataType="Date" />
      <OutputField Name="WeeksAgo7" Caption="Weeks Ago 7" DataType="Date" />
      <OutputField Name="WeeksAgo8" Caption="Weeks Ago 8" DataType="Date" />
      <OutputField Name="MonthsAgo1" Caption="Months Ago 01" DataType="Date" />
      <OutputField Name="MonthsAgo2" Caption="Months Ago 02" DataType="Date" />
      <OutputField Name="MonthsAgo3" Caption="Months Ago 03" DataType="Date" />
      <OutputField Name="MonthsAgo4" Caption="Months Ago 04" DataType="Date" />
      <OutputField Name="MonthsAgo5" Caption="Months Ago 05" DataType="Date" />
      <OutputField Name="MonthsAgo6" Caption="Months Ago 06" DataType="Date" />
      <OutputField Name="MonthsAgo7" Caption="Months Ago 07" DataType="Date" />
      <OutputField Name="MonthsAgo8" Caption="Months Ago 08" DataType="Date" />
      <OutputField Name="MonthsAgo9" Caption="Months Ago 09" DataType="Date" />
      <OutputField Name="MonthsAgo10" Caption="Months Ago 10" DataType="Date" />
      <OutputField Name="MonthsAgo11" Caption="Months Ago 11" DataType="Date" />
      <OutputField Name="MonthsAgo12" Caption="Months Ago 12" DataType="Date" />
      <OutputField Name="MonthsAgo18" Caption="Months Ago 18" DataType="Date" />
      <OutputField Name="YearsAgo1" Caption="Years Ago 01" DataType="Date" />
      <OutputField Name="YearsAgo2" Caption="Years Ago 02" DataType="Date" />
      <OutputField Name="YearsAgo3" Caption="Years Ago 03" DataType="Date" />
      <OutputField Name="YearsAgo4" Caption="Years Ago 04" DataType="Date" />
      <OutputField Name="YearsAgo5" Caption="Years Ago 05" DataType="Date" />
      <OutputField Name="YearsAgo6" Caption="Years Ago 06" DataType="Date" />
      <OutputField Name="YearsAgo7" Caption="Years Ago 07" DataType="Date" />
      <OutputField Name="YearsAgo8" Caption="Years Ago 08" DataType="Date" />
      <OutputField Name="YearsAgo9" Caption="Years Ago 09" DataType="Date" />
      <OutputField Name="YearsAgo10" Caption="Years Ago 10" DataType="Date" />
      
      <OutputField Name="DaysAhead7" Caption="Days Ahead 07" DataType="Date" />
      <OutputField Name="DaysAhead14" Caption="Days Ahead 14" DataType="Date" />
      <OutputField Name="DaysAhead21" Caption="Days Ahead 21" DataType="Date" />
      <OutputField Name="DaysAhead28" Caption="Days Ahead 28" DataType="Date" />
      <OutputField Name="MonthsAhead1" Caption="Months Ahead 1" DataType="Date" />
      <OutputField Name="MonthsAhead2" Caption="Months Ahead 2" DataType="Date" />
      <OutputField Name="MonthsAhead3" Caption="Months Ahead 3" DataType="Date" />
      <OutputField Name="MonthsAhead4" Caption="Months Ahead 4" DataType="Date" />
      <OutputField Name="MonthsAhead5" Caption="Months Ahead 5" DataType="Date" />
      <OutputField Name="MonthsAhead6" Caption="Months Ahead 6" DataType="Date" />
     </OutputFields>
  </Output>

  <RelationshipOperations>
    <AddToParentView Field="ID" ParentView="V_QUERY_CONSTITUENT" ParentViewRelatedField="ID" PathAlias="Constituent Rolling Dates (AIA)"/>
  </RelationshipOperations>

</QueryViewSpec>
