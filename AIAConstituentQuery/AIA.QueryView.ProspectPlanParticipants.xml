<QueryViewSpec
  xmlns="bb_appfx_queryview"
  xmlns:c="bb_appfx_commontypes" 
  ID="924c38a8-f8cc-473e-83d9-a3d4ff29b11f"
  Name="Prospect Plan Participant (AIA)"
  Description="Provide the ability to query plan participant fields from the Constituent record."
  Author="Danny Smith (AIA)"
  IsRoot="false"
  PrimaryKeyField="ID"
  RecordType="Plan Participant"
  c:SecurityUIFolder="Prospect Management\Prospects\Planned Giving"
  >
  <c:DependencyList>
    <c:Dependency CatalogAssembly="Blackbaud.AppFx.MajorGiving.Catalog.dll" CatalogItem="Blackbaud.AppFx.MajorGiving.Catalog.InteractionParticipant.Query.xml" />
  </c:DependencyList>
  <ResourceFile AssemblyName="Blackbaud.AppFx.MajorGiving.Catalog.dll" ClassName="Blackbaud.AppFx.MajorGiving.Catalog.PlanParticipant.Query" />

  <!-- define the view used to return data for the query -->
  <ViewImplementation ViewName="USR_AIA_V_QUERY_PLANPARTICIPANT">
    <ViewSQL>
      <![CDATA[
      
        select
          PP.ID,
          PP.PROSPECTPLANID,
          PP.CONSTITUENTID,
          PPR.DESCRIPTION ROLECODEID_TRANSLATION,
          ADDEDBY.APPLICATIONNAME as ADDEDBY_APPLICATION,
          ADDEDBY.USERNAME as ADDEDBY_USERNAME,
          CHANGEDBY.APPLICATIONNAME as CHANGEDBY_APPLICATION,
          CHANGEDBY.USERNAME as CHANGEDBY_USERNAME,
          PP.DATEADDED,
          PP.DATECHANGED
        from
          dbo.PLANPARTICIPANT PP
        left outer join
          dbo.PLANPARTICIPANTROLECODE PPR on PP.PLANPARTICIPANTROLECODEID = PPR.ID
        left outer join 
          dbo.CHANGEAGENT as ADDEDBY on ADDEDBY.ID = PP.ADDEDBYID
        left outer join 
          dbo.CHANGEAGENT as CHANGEDBY on CHANGEDBY.ID = PP.CHANGEDBYID

      ]]>
    </ViewSQL>
  </ViewImplementation>

  <Output>
    <OutputFields>
      <OutputField Caption="System Record ID" Name="ID" DataType="Guid" Category="System Fields" CaptionResourceKey="$$system_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Prospect Plan Record ID" Name="PROSPECTPLANID" DataType="Guid" Category="System Fields" CaptionResourceKey="$$prospect_plan_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Constituent Record ID" Name="CONSTITUENTID" DataType="Guid" Category="System Fields" CaptionResourceKey="$$constituent_record_id" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Role" Name="ROLECODEID_TRANSLATION" DataType="String" CaptionResourceKey="$$role">
        <LookupInfo>
          <CodeTable CodeTableName="PLANPARTICIPANTROLECODE" IncludeInactive="true" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Added by application" Category="System Fields" Name="ADDEDBY_APPLICATION" CaptionResourceKey="$$added_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Added by user name" Category="System Fields" Name="ADDEDBY_USERNAME" CaptionResourceKey="$$added_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by application" Category="System Fields" Name="CHANGEDBY_APPLICATION" CaptionResourceKey="$$changed_by_application" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="37E3E458-AF0D-4dbc-8A18-A93885521A42" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Changed by user name" Category="System Fields" Name="CHANGEDBY_USERNAME" CaptionResourceKey="$$changed_by_user_name" CategoryResourceKey="$$system_fields">
        <LookupInfo>
          <SimpleDataList SimpleDataListID="CEA15E1C-E455-41be-9ECF-6B5453FA96A4" />
        </LookupInfo>
      </OutputField>
      <OutputField Caption="Date added" Category="System Fields" Name="DATEADDED" CaptionResourceKey="$$date_added" CategoryResourceKey="$$system_fields" />
      <OutputField Caption="Date changed" Category="System Fields" Name="DATECHANGED" CaptionResourceKey="$$date_changed" CategoryResourceKey="$$system_fields" />
    </OutputFields>
  </Output>
  <RelationshipOperations>
    <AddToParentView Field="CONSTITUENTID" ParentView="V_QUERY_CONSTITUENT" ParentViewRelatedField="ID" PathAlias="Prospect Plan Participant (AIA)" />
    <AddRelatedView RelatedView="V_QUERY_PROSPECTPLAN" RelatedField="ID" Field="PROSPECTPLANID" PathAlias="Prospect Plans" DisplayAliasResourceKey="$$prospect_plans" />
  </RelationshipOperations>
</QueryViewSpec>
